
/*!
 * Router v0.3.0 (Router ror SPA)
 * Build: 08.03.2025, 00:13:52
 * Copyright 2025 by Serhii Pimenov
 * Licensed under MIT
 */

var w="0.3.0",m="08.03.2025, 00:13:52",a=class{constructor(t={}){if(this.routes={},this.fallbackRoute=t.fallback||"/",this.maxRedirects=t.maxRedirects||5,this.redirectCount=0,this.basePath=t.base||"",this.middleware=[],this.beforeEachHooks=[],this.afterEachHooks=[],this.cache=new Map,this.cacheLimit=t.cacheLimit??50,this.touchStartX=0,this.enableSwipeNavigation=t.enableSwipeNavigation||!1,this.current=null,this.redirects={},this.useHash=t.useHash||!1,this.events={beforeNavigate:[],afterNavigate:[],routeNotFound:[],error:[]},this.enableSwipeNavigation&&this.initSwipeNavigation(),t.routes)for(let[e,i]of Object.entries(t.routes))this.addRoute(e,i);window.addEventListener("unhandledrejection",this.handleError.bind(this))}on(t,e){return this.events[t]&&this.events[t].push(e),this}emit(t,...e){if(this.events[t])for(let i of this.events[t]){let r=i(...e);if(t==="beforeNavigate"&&r===!1)return!1}return!0}initSwipeNavigation(){document.addEventListener("touchstart",t=>{this.touchStartX=t.touches[0].clientX},{passive:!0}),document.addEventListener("touchend",t=>{let e=t.changedTouches[0].clientX,i=this.touchStartX-e;Math.abs(i)>100&&(i>0?window.history.forward():window.history.back())},{passive:!0})}handleError(t){this.emit("error",t),this.routes["/error"]?this.navigateTo("/error",!0):this.navigateTo(this.fallbackRoute,!0)}sanitizePath(t){try{if(!t)return"/";let e=new URL(t,window.location.origin),i=decodeURIComponent(e.pathname);return i=i.replace(/[<>'"`;(){}]/g,"").replace(/[\u0000-\u001F\u007F-\u009F]/g,"").replace(/([^/])\/{2,}/g,"$1/").replace(/\/+/g,"/").replace(/(.+)\/$/,"$1").replace(/\.+/g,".").split("/").filter(r=>r!==".."&&r!==".").join("/"),i.startsWith("/")||(i="/"+i),this.isBlockedPath(i)?"/":i}catch{return"/"}}isBlockedPath(t){return[/^\/(api|admin|wp-admin|wp-content|wp-includes)/i,/\.(php|asp|aspx|jsp|cgi|config|env|git|sql|htaccess)$/i,/\/(.+\/)*\.{2,}\//,/javascript:/i,/data:/i,/vbscript:/i,/file:/i].some(i=>i.test(t))}test(t){let e=t,i=this.sanitizePath(t);return{original:e,sanitized:i,isBlocked:this.isBlockedPath(i),isModified:e!==i}}beforeEach(t){return this.beforeEachHooks.push(t),this}afterEach(t){return this.afterEachHooks.push(t),this}use(t){return this.middleware.push(t),this}addRedirect(t,e){return this.redirects[t]?!1:(this.redirects[t]=e,this)}addRoute(t,e){return this.routes[t]=e,this}addNestedRoute(t,e,i){let r=`${t}${e}`.replace(/\/\//g,"/");return this.addRoute(r,i),this}addLazyRoute(t,e){return this.addRoute(t,async i=>{try{let r=await e();return(r.default||r)(i)}catch(r){throw r}}),this}addLazyNestedRoute(t,e,i){let r=`${t}${e}`.replace(/\/\//g,"/");return this.addLazyRoute(r,i),this}addFallbackRoute(t){return this.fallbackRoute=t,this}add404Route(t){return this.routes["/404"]=t,this}addErrorRoute(t){return this.routes["/error"]=t,this}addProtectedRoute(t,e,i){return this.addRoute(t,async r=>{if(await i(r))return e(r);await this.navigateTo("/login",!0)}),this}removeRoute(t){return this.routes[t]&&delete this.routes[t],this}updateRoute(t,e){return this.routes[t]&&(this.routes[t]=e),this}getRoutes(){return this.routes}async navigate(t){if(this.redirectCount>this.maxRedirects){console.error("Maximum redirect limit reached"),this.redirectCount=0,this.emit("error",new Error("Maximum redirect limit reached")),await this.navigateTo("/error",!0);return}this.redirectCount++;let e=this.matchRoute(this.sanitizePath(t));if(e)try{if(await this.emit("beforeNavigate",e)===!1)return;if(this.redirects[e.path]){await this.navigateTo(this.redirects[e.path],!0);return}this.redirectCount++;for(let r of this.middleware)await r(e);for(let r of this.beforeEachHooks)await r(e);await e.callback(e.params);for(let r of this.afterEachHooks)await r(e);this.current=e,this.emit("afterNavigate",e)}catch(i){console.error("Navigation error:",i),this.emit("error",i),this.routes["/error"]&&this.routes["/error"](i)}else this.redirectCount=0,this.emit("routeNotFound",t),this.routes["/404"]&&this.routes["/404"]()}async navigateTo(t,e=!1){this.redirectCount=0;let i=new URL(t,window.location.origin);e?window.history.replaceState({},"",i):window.history.pushState({},"",i),await this.navigate(i.pathname)}matchRoute(t){if(this.cache.has(t))return this.cache.get(t);let e=this._performMatch(t);if(this.cache.size>=this.cacheLimit){let i=this.cache.keys().next().value;this.cache.delete(i)}return this.cache.set(t,e),e}_performMatch(t){let[e,i]=t.split("?"),r=new URLSearchParams(i),o=Object.fromEntries(r);for(let h in this.routes){let n=[],c=h.replace(/:([^\/]+)/g,(d,s)=>(n.push(s),"([^/]+)")),u=t.match(new RegExp(`^${c}$`));if(u){let d=u.slice(1).reduce((s,f,g)=>(s[n[g]]=f,s),{});return{path:t,pattern:c,callback:this.routes[h],params:d,query:o}}}return null}clearCache(){this.cache.clear()}resetRedirectCount(){this.redirectCount=0}getFullPath(t){return this.useHash?`#${t}`:t}getPathFromLocation(){return this.useHash?window.location.hash.slice(1)||"/":window.location.pathname}listen(){let t=this.useHash?"hashchange":"popstate";window.addEventListener(t,()=>{this.redirectCount=0,this.navigate(this.getPathFromLocation())}),document.addEventListener("click",e=>{if(e.target.tagName==="A"){let i=e.target.getAttribute("href");if(i&&(this.useHash&&i.startsWith("#")||!this.useHash&&e.target.href.startsWith(window.location.origin))){e.preventDefault();let r=this.useHash?i.slice(1):e.target.pathname;this.redirectCount=0,this.navigateTo(r)}}}),this.redirectCount=0,this.navigate(this.getPathFromLocation())}};a.info=()=>{console.info(`%c Router %c v${w} %c ${m} `,"color: #ffffff; font-weight: bold; background: #ed1cab","color: white; background: darkgreen","color: white; background: #0080fe;")};var l=a;var R=l;export{R as default};
