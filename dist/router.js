
/*!
 * Router v0.3.0 (Router ror SPA)
 * Build: 23.02.2025, 21:14:58
 * Copyright 2025 by Serhii Pimenov
 * Licensed under MIT
 */

var w="0.3.0",p="23.02.2025, 21:14:58",s=class r{static debug=!1;static log(...t){r.debug&&console.log("[Router]:",...t)}constructor(t={}){if(this.routes={},this.fallbackRoute=t.fallback||"/",this.maxRedirects=t.maxRedirects||5,this.redirectCount=0,this.basePath=t.base||"",this.middleware=[],this.beforeEachHooks=[],this.afterEachHooks=[],this.cache=new Map,this.cacheLimit=t.cacheLimit??50,this.touchStartX=0,this.enableSwipeNavigation=t.enableSwipeNavigation||!1,this.current=null,this.redirects={},this.enableSwipeNavigation&&this.initSwipeNavigation(),t.routes)for(let[i,e]of Object.entries(t.routes))this.addRoute(i,e);window.addEventListener("unhandledrejection",this.handleError.bind(this))}initSwipeNavigation(){document.addEventListener("touchstart",t=>{this.touchStartX=t.touches[0].clientX},{passive:!0}),document.addEventListener("touchend",t=>{let i=t.changedTouches[0].clientX,e=this.touchStartX-i;Math.abs(e)>100&&(e>0?window.history.forward():window.history.back())},{passive:!0})}handleError(t){r.log("Critical error:",t),this.routes["/error"]?this.navigateTo("/error",!0):this.navigateTo(this.fallbackRoute,!0)}sanitizePath(t){try{if(!t)return"/";let i=new URL(t,window.location.origin),e=decodeURIComponent(i.pathname);return e=e.replace(/[<>'"`;(){}]/g,"").replace(/[\u0000-\u001F\u007F-\u009F]/g,"").replace(/([^/])\/{2,}/g,"$1/").replace(/\/+/g,"/").replace(/(.+)\/$/,"$1").replace(/\.+/g,".").split("/").filter(o=>o!==".."&&o!==".").join("/"),e.startsWith("/")||(e="/"+e),this.isBlockedPath(e)?(r.log("Blocked malicious path:",t),"/"):e}catch(i){return r.log("Invalid URL:",i),"/"}}isBlockedPath(t){return[/^\/(api|admin|wp-admin|wp-content|wp-includes)/i,/\.(php|asp|aspx|jsp|cgi|config|env|git|sql|htaccess)$/i,/\/(.+\/)*\.{2,}\//,/javascript:/i,/data:/i,/vbscript:/i,/file:/i].some(e=>e.test(t))}test(t){let i=t,e=this.sanitizePath(t);return{original:i,sanitized:e,isBlocked:this.isBlockedPath(e),isModified:i!==e}}beforeEach(t){r.log("Register BE hook ",t.name),this.beforeEachHooks.push(t)}afterEach(t){r.log("Register AE hook ",t.name),this.afterEachHooks.push(t)}use(t){r.log("Register middleware",t.name),this.middleware.push(t)}addRedirect(t,i){if(this.redirects[t])return r.log("Redirect already exists:",t),!1;r.log("Add redirect:",t,"->",i),this.redirects[t]=i}addRoute(t,i){r.log("Add route :",t),this.routes[t]=i}removeRoute(t){return r.log("Remove route :",t),this.routes[t]?(delete this.routes[t],!0):!1}updateRoute(t,i){return r.log("Update route :",t),this.routes[t]?(this.routes[t]=i,!0):!1}getRoutes(){return this.routes}async navigate(t){if(this.redirectCount>this.maxRedirects){console.error("Maximum redirect limit reached"),this.redirectCount=0,await this.navigateTo("/error",!0);return}this.redirectCount++;let i=this.matchRoute(this.sanitizePath(t));if(i)try{if(this.redirects[i.path]){r.log("Redirecting from",i.path,"to",this.redirects[i.path]),await this.navigateTo(this.redirects[i.path],!0);return}this.redirectCount++;for(let e of this.middleware)r.log("Run middleware:",e.name),await e(i);for(let e of this.beforeEachHooks)r.log("Run BE hook :",e.name),await e(i);r.log("Run route component with params:",i.params),await i.callback(i.params);for(let e of this.afterEachHooks)r.log("Run AE hook :",e.name),await e(i);this.current=i}catch(e){console.error("Navigation error:",e),this.routes["/error"]&&this.routes["/error"](e)}else r.log("Run not found route!"),this.redirectCount=0,this.routes["/404"]&&this.routes["/404"]()}async navigateTo(t,i=!1){r.log("Programmatic navigation to:",t),this.redirectCount=0;let e=new URL(t,window.location.origin);i?window.history.replaceState({},"",e):window.history.pushState({},"",e),await this.navigate(e.pathname)}matchRoute(t){if(this.cache.has(t))return this.cache.get(t);let i=this._performMatch(t);if(this.cache.size>=this.cacheLimit){let e=this.cache.keys().next().value;this.cache.delete(e)}return this.cache.set(t,i),i}_performMatch(t){r.log("Matching route for path:",t);let[i,e]=t.split("?"),o=new URLSearchParams(e),g=Object.fromEntries(o);for(let n in this.routes){let c=[],h=n.replace(/:([^\/]+)/g,(d,a)=>(c.push(a),"([^/]+)")),u=t.match(new RegExp(`^${h}$`));if(u){r.log("Route found:",n);let d=u.slice(1).reduce((a,f,m)=>(a[c[m]]=f,a),{});return{path:t,pattern:h,callback:this.routes[n],params:d,query:g}}}return null}clearCache(){this.cache.clear()}resetRedirectCount(){this.redirectCount=0}listen(){window.addEventListener("popstate",()=>{r.log("Popstate event triggered"),this.redirectCount=0,this.navigate(window.location.pathname)}),document.addEventListener("click",t=>{t.target.tagName==="A"&&t.target.href.startsWith(window.location.origin)&&(t.preventDefault(),r.log("Popstate event triggered",t.target.href),this.redirectCount=0,window.history.pushState({},"",t.target.href),this.navigate(t.target.pathname))}),this.redirectCount=0,this.navigate(window.location.pathname)}};s.info=()=>{console.info(`%c Router %c v${w} %c ${p} `,"color: #ffffff; font-weight: bold; background: #ed1cab","color: white; background: darkgreen","color: white; background: #0080fe;")};var l=s;var v=l;export{v as default};
